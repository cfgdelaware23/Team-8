"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _token = require("./token");
const FEATURE_ID = {
  SESSIONRECOVERY: 0x01,
  FEDAUTH: 0x02,
  COLUMNENCRYPTION: 0x04,
  GLOBALTRANSACTIONS: 0x05,
  AZURESQLSUPPORT: 0x08,
  UTF8_SUPPORT: 0x0A,
  TERMINATOR: 0xFF
};
function featureExtAckParser(parser, _options, callback) {
  let fedAuth;
  let utf8Support;
  function next() {
    parser.readUInt8(featureId => {
      if (featureId === FEATURE_ID.TERMINATOR) {
        return callback(new _token.FeatureExtAckToken(fedAuth, utf8Support));
      }
      parser.readUInt32LE(featureAckDataLen => {
        parser.readBuffer(featureAckDataLen, featureData => {
          switch (featureId) {
            case FEATURE_ID.FEDAUTH:
              fedAuth = featureData;
              break;
            case FEATURE_ID.UTF8_SUPPORT:
              utf8Support = !!featureData[0];
              break;
          }
          next();
        });
      });
    });
  }
  next();
}
var _default = featureExtAckParser;
exports.default = _default;
module.exports = featureExtAckParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdG9rZW4iLCJyZXF1aXJlIiwiRkVBVFVSRV9JRCIsIlNFU1NJT05SRUNPVkVSWSIsIkZFREFVVEgiLCJDT0xVTU5FTkNSWVBUSU9OIiwiR0xPQkFMVFJBTlNBQ1RJT05TIiwiQVpVUkVTUUxTVVBQT1JUIiwiVVRGOF9TVVBQT1JUIiwiVEVSTUlOQVRPUiIsImZlYXR1cmVFeHRBY2tQYXJzZXIiLCJwYXJzZXIiLCJfb3B0aW9ucyIsImNhbGxiYWNrIiwiZmVkQXV0aCIsInV0ZjhTdXBwb3J0IiwibmV4dCIsInJlYWRVSW50OCIsImZlYXR1cmVJZCIsIkZlYXR1cmVFeHRBY2tUb2tlbiIsInJlYWRVSW50MzJMRSIsImZlYXR1cmVBY2tEYXRhTGVuIiwicmVhZEJ1ZmZlciIsImZlYXR1cmVEYXRhIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCIsIm1vZHVsZSJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b2tlbi9mZWF0dXJlLWV4dC1hY2stcGFyc2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQYXJzZXIsIHsgdHlwZSBQYXJzZXJPcHRpb25zIH0gZnJvbSAnLi9zdHJlYW0tcGFyc2VyJztcblxuaW1wb3J0IHsgRmVhdHVyZUV4dEFja1Rva2VuIH0gZnJvbSAnLi90b2tlbic7XG5cbmNvbnN0IEZFQVRVUkVfSUQgPSB7XG4gIFNFU1NJT05SRUNPVkVSWTogMHgwMSxcbiAgRkVEQVVUSDogMHgwMixcbiAgQ09MVU1ORU5DUllQVElPTjogMHgwNCxcbiAgR0xPQkFMVFJBTlNBQ1RJT05TOiAweDA1LFxuICBBWlVSRVNRTFNVUFBPUlQ6IDB4MDgsXG4gIFVURjhfU1VQUE9SVDogMHgwQSxcbiAgVEVSTUlOQVRPUjogMHhGRlxufTtcblxuZnVuY3Rpb24gZmVhdHVyZUV4dEFja1BhcnNlcihwYXJzZXI6IFBhcnNlciwgX29wdGlvbnM6IFBhcnNlck9wdGlvbnMsIGNhbGxiYWNrOiAodG9rZW46IEZlYXR1cmVFeHRBY2tUb2tlbikgPT4gdm9pZCkge1xuICBsZXQgZmVkQXV0aDogQnVmZmVyIHwgdW5kZWZpbmVkO1xuICBsZXQgdXRmOFN1cHBvcnQ6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG5cbiAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICBwYXJzZXIucmVhZFVJbnQ4KChmZWF0dXJlSWQpID0+IHtcbiAgICAgIGlmIChmZWF0dXJlSWQgPT09IEZFQVRVUkVfSUQuVEVSTUlOQVRPUikge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IEZlYXR1cmVFeHRBY2tUb2tlbihmZWRBdXRoLCB1dGY4U3VwcG9ydCkpO1xuICAgICAgfVxuXG4gICAgICBwYXJzZXIucmVhZFVJbnQzMkxFKChmZWF0dXJlQWNrRGF0YUxlbikgPT4ge1xuICAgICAgICBwYXJzZXIucmVhZEJ1ZmZlcihmZWF0dXJlQWNrRGF0YUxlbiwgKGZlYXR1cmVEYXRhKSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChmZWF0dXJlSWQpIHtcbiAgICAgICAgICAgIGNhc2UgRkVBVFVSRV9JRC5GRURBVVRIOlxuICAgICAgICAgICAgICBmZWRBdXRoID0gZmVhdHVyZURhdGE7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBGRUFUVVJFX0lELlVURjhfU1VQUE9SVDpcbiAgICAgICAgICAgICAgdXRmOFN1cHBvcnQgPSAhIWZlYXR1cmVEYXRhWzBdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgbmV4dCgpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmZWF0dXJlRXh0QWNrUGFyc2VyO1xubW9kdWxlLmV4cG9ydHMgPSBmZWF0dXJlRXh0QWNrUGFyc2VyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFFQSxNQUFNQyxVQUFVLEdBQUc7RUFDakJDLGVBQWUsRUFBRSxJQUFJO0VBQ3JCQyxPQUFPLEVBQUUsSUFBSTtFQUNiQyxnQkFBZ0IsRUFBRSxJQUFJO0VBQ3RCQyxrQkFBa0IsRUFBRSxJQUFJO0VBQ3hCQyxlQUFlLEVBQUUsSUFBSTtFQUNyQkMsWUFBWSxFQUFFLElBQUk7RUFDbEJDLFVBQVUsRUFBRTtBQUNkLENBQUM7QUFFRCxTQUFTQyxtQkFBbUJBLENBQUNDLE1BQWMsRUFBRUMsUUFBdUIsRUFBRUMsUUFBNkMsRUFBRTtFQUNuSCxJQUFJQyxPQUEyQjtFQUMvQixJQUFJQyxXQUFnQztFQUVwQyxTQUFTQyxJQUFJQSxDQUFBLEVBQUc7SUFDZEwsTUFBTSxDQUFDTSxTQUFTLENBQUVDLFNBQVMsSUFBSztNQUM5QixJQUFJQSxTQUFTLEtBQUtoQixVQUFVLENBQUNPLFVBQVUsRUFBRTtRQUN2QyxPQUFPSSxRQUFRLENBQUMsSUFBSU0seUJBQWtCLENBQUNMLE9BQU8sRUFBRUMsV0FBVyxDQUFDLENBQUM7TUFDL0Q7TUFFQUosTUFBTSxDQUFDUyxZQUFZLENBQUVDLGlCQUFpQixJQUFLO1FBQ3pDVixNQUFNLENBQUNXLFVBQVUsQ0FBQ0QsaUJBQWlCLEVBQUdFLFdBQVcsSUFBSztVQUNwRCxRQUFRTCxTQUFTO1lBQ2YsS0FBS2hCLFVBQVUsQ0FBQ0UsT0FBTztjQUNyQlUsT0FBTyxHQUFHUyxXQUFXO2NBQ3JCO1lBQ0YsS0FBS3JCLFVBQVUsQ0FBQ00sWUFBWTtjQUMxQk8sV0FBVyxHQUFHLENBQUMsQ0FBQ1EsV0FBVyxDQUFDLENBQUMsQ0FBQztjQUM5QjtVQUNKO1VBQ0FQLElBQUksQ0FBQyxDQUFDO1FBQ1IsQ0FBQyxDQUFDO01BQ0osQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDO0VBQ0o7RUFFQUEsSUFBSSxDQUFDLENBQUM7QUFDUjtBQUFDLElBQUFRLFFBQUEsR0FFY2QsbUJBQW1CO0FBQUFlLE9BQUEsQ0FBQUMsT0FBQSxHQUFBRixRQUFBO0FBQ2xDRyxNQUFNLENBQUNGLE9BQU8sR0FBR2YsbUJBQW1CIn0=