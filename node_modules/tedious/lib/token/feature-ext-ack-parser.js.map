{"version":3,"file":"feature-ext-ack-parser.js","names":["_token","require","FEATURE_ID","SESSIONRECOVERY","FEDAUTH","COLUMNENCRYPTION","GLOBALTRANSACTIONS","AZURESQLSUPPORT","UTF8_SUPPORT","TERMINATOR","featureExtAckParser","parser","_options","callback","fedAuth","utf8Support","next","readUInt8","featureId","FeatureExtAckToken","readUInt32LE","featureAckDataLen","readBuffer","featureData","_default","exports","default","module"],"sources":["../../src/token/feature-ext-ack-parser.ts"],"sourcesContent":["import Parser, { type ParserOptions } from './stream-parser';\n\nimport { FeatureExtAckToken } from './token';\n\nconst FEATURE_ID = {\n  SESSIONRECOVERY: 0x01,\n  FEDAUTH: 0x02,\n  COLUMNENCRYPTION: 0x04,\n  GLOBALTRANSACTIONS: 0x05,\n  AZURESQLSUPPORT: 0x08,\n  UTF8_SUPPORT: 0x0A,\n  TERMINATOR: 0xFF\n};\n\nfunction featureExtAckParser(parser: Parser, _options: ParserOptions, callback: (token: FeatureExtAckToken) => void) {\n  let fedAuth: Buffer | undefined;\n  let utf8Support: boolean | undefined;\n\n  function next() {\n    parser.readUInt8((featureId) => {\n      if (featureId === FEATURE_ID.TERMINATOR) {\n        return callback(new FeatureExtAckToken(fedAuth, utf8Support));\n      }\n\n      parser.readUInt32LE((featureAckDataLen) => {\n        parser.readBuffer(featureAckDataLen, (featureData) => {\n          switch (featureId) {\n            case FEATURE_ID.FEDAUTH:\n              fedAuth = featureData;\n              break;\n            case FEATURE_ID.UTF8_SUPPORT:\n              utf8Support = !!featureData[0];\n              break;\n          }\n          next();\n        });\n      });\n    });\n  }\n\n  next();\n}\n\nexport default featureExtAckParser;\nmodule.exports = featureExtAckParser;\n"],"mappings":";;;;;;AAEA,IAAAA,MAAA,GAAAC,OAAA;AAEA,MAAMC,UAAU,GAAG;EACjBC,eAAe,EAAE,IAAI;EACrBC,OAAO,EAAE,IAAI;EACbC,gBAAgB,EAAE,IAAI;EACtBC,kBAAkB,EAAE,IAAI;EACxBC,eAAe,EAAE,IAAI;EACrBC,YAAY,EAAE,IAAI;EAClBC,UAAU,EAAE;AACd,CAAC;AAED,SAASC,mBAAmBA,CAACC,MAAc,EAAEC,QAAuB,EAAEC,QAA6C,EAAE;EACnH,IAAIC,OAA2B;EAC/B,IAAIC,WAAgC;EAEpC,SAASC,IAAIA,CAAA,EAAG;IACdL,MAAM,CAACM,SAAS,CAAEC,SAAS,IAAK;MAC9B,IAAIA,SAAS,KAAKhB,UAAU,CAACO,UAAU,EAAE;QACvC,OAAOI,QAAQ,CAAC,IAAIM,yBAAkB,CAACL,OAAO,EAAEC,WAAW,CAAC,CAAC;MAC/D;MAEAJ,MAAM,CAACS,YAAY,CAAEC,iBAAiB,IAAK;QACzCV,MAAM,CAACW,UAAU,CAACD,iBAAiB,EAAGE,WAAW,IAAK;UACpD,QAAQL,SAAS;YACf,KAAKhB,UAAU,CAACE,OAAO;cACrBU,OAAO,GAAGS,WAAW;cACrB;YACF,KAAKrB,UAAU,CAACM,YAAY;cAC1BO,WAAW,GAAG,CAAC,CAACQ,WAAW,CAAC,CAAC,CAAC;cAC9B;UACJ;UACAP,IAAI,CAAC,CAAC;QACR,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAA,IAAI,CAAC,CAAC;AACR;AAAC,IAAAQ,QAAA,GAEcd,mBAAmB;AAAAe,OAAA,CAAAC,OAAA,GAAAF,QAAA;AAClCG,MAAM,CAACF,OAAO,GAAGf,mBAAmB"}