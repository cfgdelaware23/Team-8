{"version":3,"file":"row-token-parser.js","names":["_token","require","_valueParser","_interopRequireDefault","obj","__esModule","default","rowParser","parser","colMetadata","length","columns","i","currColMetadata","value","valueParse","options","v","suspended","streamBuffer","waitForChunk","next","push","metadata","useColumnNames","columnsMap","Object","create","forEach","column","colName","RowToken","_default","exports","module"],"sources":["../../src/token/row-token-parser.ts"],"sourcesContent":["// s2.2.7.17\n\nimport Parser from './stream-parser';\nimport { type ColumnMetadata } from './colmetadata-token-parser';\n\nimport { RowToken } from './token';\n\nimport valueParse from '../value-parser';\n\ninterface Column {\n  value: unknown;\n  metadata: ColumnMetadata;\n}\n\nasync function rowParser(parser: Parser): Promise<RowToken> {\n  const colMetadata = parser.colMetadata;\n  const length = colMetadata.length;\n  const columns: Column[] = [];\n\n  for (let i = 0; i < length; i++) {\n    const currColMetadata = colMetadata[i];\n    let value;\n    valueParse(parser, currColMetadata, parser.options, (v) => {\n      value = v;\n    });\n\n    while (parser.suspended) {\n      await parser.streamBuffer.waitForChunk();\n\n      parser.suspended = false;\n      const next = parser.next!;\n\n      next();\n    }\n    columns.push({\n      value,\n      metadata: currColMetadata\n    });\n  }\n\n  if (parser.options.useColumnNames) {\n    const columnsMap: { [key: string]: Column } = Object.create(null);\n\n    columns.forEach((column) => {\n      const colName = column.metadata.colName;\n      if (columnsMap[colName] == null) {\n        columnsMap[colName] = column;\n      }\n    });\n\n    return new RowToken(columnsMap);\n  } else {\n    return new RowToken(columns);\n  }\n}\n\nexport default rowParser;\nmodule.exports = rowParser;\n"],"mappings":";;;;;;AAKA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,YAAA,GAAAC,sBAAA,CAAAF,OAAA;AAAyC,SAAAE,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAPzC;;AAcA,eAAeG,SAASA,CAACC,MAAc,EAAqB;EAC1D,MAAMC,WAAW,GAAGD,MAAM,CAACC,WAAW;EACtC,MAAMC,MAAM,GAAGD,WAAW,CAACC,MAAM;EACjC,MAAMC,OAAiB,GAAG,EAAE;EAE5B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,MAAM,EAAEE,CAAC,EAAE,EAAE;IAC/B,MAAMC,eAAe,GAAGJ,WAAW,CAACG,CAAC,CAAC;IACtC,IAAIE,KAAK;IACT,IAAAC,oBAAU,EAACP,MAAM,EAAEK,eAAe,EAAEL,MAAM,CAACQ,OAAO,EAAGC,CAAC,IAAK;MACzDH,KAAK,GAAGG,CAAC;IACX,CAAC,CAAC;IAEF,OAAOT,MAAM,CAACU,SAAS,EAAE;MACvB,MAAMV,MAAM,CAACW,YAAY,CAACC,YAAY,CAAC,CAAC;MAExCZ,MAAM,CAACU,SAAS,GAAG,KAAK;MACxB,MAAMG,IAAI,GAAGb,MAAM,CAACa,IAAK;MAEzBA,IAAI,CAAC,CAAC;IACR;IACAV,OAAO,CAACW,IAAI,CAAC;MACXR,KAAK;MACLS,QAAQ,EAAEV;IACZ,CAAC,CAAC;EACJ;EAEA,IAAIL,MAAM,CAACQ,OAAO,CAACQ,cAAc,EAAE;IACjC,MAAMC,UAAqC,GAAGC,MAAM,CAACC,MAAM,CAAC,IAAI,CAAC;IAEjEhB,OAAO,CAACiB,OAAO,CAAEC,MAAM,IAAK;MAC1B,MAAMC,OAAO,GAAGD,MAAM,CAACN,QAAQ,CAACO,OAAO;MACvC,IAAIL,UAAU,CAACK,OAAO,CAAC,IAAI,IAAI,EAAE;QAC/BL,UAAU,CAACK,OAAO,CAAC,GAAGD,MAAM;MAC9B;IACF,CAAC,CAAC;IAEF,OAAO,IAAIE,eAAQ,CAACN,UAAU,CAAC;EACjC,CAAC,MAAM;IACL,OAAO,IAAIM,eAAQ,CAACpB,OAAO,CAAC;EAC9B;AACF;AAAC,IAAAqB,QAAA,GAEczB,SAAS;AAAA0B,OAAA,CAAA3B,OAAA,GAAA0B,QAAA;AACxBE,MAAM,CAACD,OAAO,GAAG1B,SAAS"}